CREATE SCHEMA FORTES;
USE FORTES;

CREATE TABLE IF NOT EXISTS USUARIOS(
USER_COD INT PRIMARY KEY,
USER_CNPJ VARCHAR(14) NOT NULL,
USER_NOME VARCHAR(45) NOT NULL,
USER_CATEGORIA TINYINT NOT NULL, # 1 = DONATÁRIO , 0 = FUNCIONÁRIO
USER_TEL VARCHAR(15) NOT NULL,
USER_EMAIL VARCHAR(100) NOT NULL,
USER_RAZAOSOCIAL VARCHAR(45) NOT NULL
);

CREATE TABLE IF NOT EXISTS EDITAIS(
EDITAL_COD INT PRIMARY KEY,
EDITAL_PRAZOINICIO DATE NOT NULL,
EDITAL_PRAZOFIM DATE NOT NULL,
EDITAL_DESCRICAO LONGTEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS PROJETOS(
PROJ_COD INT PRIMARY KEY,
PROJ_NOME VARCHAR(45) NOT NULL,
PROJ_RESPTEC VARCHAR(45) NOT NULL,
PROJ_RESPCOOL VARCHAR(45) NOT NULL,
COD_EDITAL INT NOT NULL,
CONSTRAINT FK_EDITAL FOREIGN KEY (COD_EDITAL) REFERENCES EDITAIS(EDITAL_COD)
);

CREATE TABLE IF NOT EXISTS RELATORIOS(
RELAT_COD INT PRIMARY KEY,
RELAT_DATA DATE NOT NULL,
RELAT_IMG BLOB,
RELAT_TEXT LONGTEXT NOT NULL,
USER_COD INT NOT NULL,
PROJ_COD INT NOT NULL,
CONSTRAINT FK_USER_COD_RELAT FOREIGN KEY (USER_COD) REFERENCES USUARIOS(USER_COD),
CONSTRAINT FK_PROJETO FOREIGN KEY (PROJ_COD) REFERENCES PROJETOS(PROJ_COD)
);

CREATE TABLE IF NOT EXISTS PROPOSTAS_PEDIDOS(
PROPE_COD INT PRIMARY KEY,
PROPE_VALOR DEC(10,2) NOT NULL,
USER_COD INT NOT NULL,
PROJ_COD INT NOT NULL,
CONSTRAINT FK_USER_COD_PROPE FOREIGN KEY (USER_COD) REFERENCES USUARIOS(USER_COD),
CONSTRAINT FK_PROJETO_PROP FOREIGN KEY (PROJ_COD) REFERENCES PROJETOS(PROJ_COD)
);

CREATE TABLE IF NOT EXISTS INSCRICAO(
COD_USUARIO INT NOT NULL,
COD_PROJETO INT NOT NULL,
PRIMARY KEY (COD_USUARIO, COD_PROJETO),
CONSTRAINT FK_USUARIO FOREIGN KEY (COD_USUARIO) REFERENCES USUARIOS(USER_COD),
CONSTRAINT FK_PROJETO_INSC FOREIGN KEY (COD_PROJETO) REFERENCES PROJETOS(PROJ_COD)
);
